"use strict";(self.webpackChunkseatunnel_website=self.webpackChunkseatunnel_website||[]).push([[78704],{15680:(e,n,t)=>{t.d(n,{xA:()=>c,yg:()=>m});var a=t(96540);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function p(e,n){if(null==e)return{};var t,a,o=function(e,n){if(null==e)return{};var t,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var s=a.createContext({}),l=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},c=function(e){var n=l(e.components);return a.createElement(s.Provider,{value:n},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},y=a.forwardRef((function(e,n){var t=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,c=p(e,["components","mdxType","originalType","parentName"]),d=l(t),y=o,m=d["".concat(s,".").concat(y)]||d[y]||u[y]||r;return t?a.createElement(m,i(i({ref:n},c),{},{components:t})):a.createElement(m,i({ref:n},c))}));function m(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var r=t.length,i=new Array(r);i[0]=y;var p={};for(var s in n)hasOwnProperty.call(n,s)&&(p[s]=n[s]);p.originalType=e,p[d]="string"==typeof e?e:o,i[1]=p;for(var l=2;l<r;l++)i[l]=t[l];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}y.displayName="MDXCreateElement"},6839:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>i,default:()=>u,frontMatter:()=>r,metadata:()=>p,toc:()=>l});var a=t(58168),o=(t(96540),t(15680));const r={},i="Config File Encryption And Decryption",p={unversionedId:"connector-v2/Config-Encryption-Decryption",id:"connector-v2/Config-Encryption-Decryption",title:"Config File Encryption And Decryption",description:"Introduction",source:"@site/docs/connector-v2/Config-Encryption-Decryption.md",sourceDirName:"connector-v2",slug:"/connector-v2/Config-Encryption-Decryption",permalink:"/docs/connector-v2/Config-Encryption-Decryption",draft:!1,editUrl:"https://github.com/apache/seatunnel-website/edit/main/docs/connector-v2/Config-Encryption-Decryption.md",tags:[],version:"current",frontMatter:{},sidebar:"docs",previous:{title:"Error Quick Reference Manual",permalink:"/docs/connector-v2/Error-Quick-Reference-Manual"},next:{title:"Transform-V2",permalink:"/docs/transform-v2"}},s={},l=[{value:"Introduction",id:"introduction",level:2},{value:"How to use",id:"how-to-use",level:2},{value:"How to implement user-defined encryption and decryption",id:"how-to-implement-user-defined-encryption-and-decryption",level:2},{value:"How to encrypt and decrypt with customized params",id:"how-to-encrypt-and-decrypt-with-customized-params",level:3}],c={toc:l},d="wrapper";function u(e){let{components:n,...t}=e;return(0,o.yg)(d,(0,a.A)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,o.yg)("h1",{id:"config-file-encryption-and-decryption"},"Config File Encryption And Decryption"),(0,o.yg)("h2",{id:"introduction"},"Introduction"),(0,o.yg)("p",null,"In most production environments, sensitive configuration items such as passwords are required to be encrypted and cannot be stored in plain text, SeaTunnel provides a convenient one-stop solution for this."),(0,o.yg)("h2",{id:"how-to-use"},"How to use"),(0,o.yg)("p",null,"SeaTunnel comes with the function of base64 encryption and decryption, but it is not recommended for production use, it is recommended that users implement custom encryption and decryption logic. You can refer to this chapter ","[How to implement user-defined encryption and decryption]","(#How to implement user-defined encryption and decryption) get more details about it."),(0,o.yg)("p",null,"Base64 encryption support encrypt the following parameters by default:"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},"username"),(0,o.yg)("li",{parentName:"ul"},"password"),(0,o.yg)("li",{parentName:"ul"},"auth"),(0,o.yg)("li",{parentName:"ul"},"token"),(0,o.yg)("li",{parentName:"ul"},"access_key"),(0,o.yg)("li",{parentName:"ul"},"secret_key")),(0,o.yg)("p",null,"And users can add custom parameters to ",(0,o.yg)("inlineCode",{parentName:"p"},"shade.options")," for encryption and decryption."),(0,o.yg)("p",null,"Next, I'll show how to quickly use SeaTunnel's own ",(0,o.yg)("inlineCode",{parentName:"p"},"base64")," encryption:"),(0,o.yg)("ol",null,(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("p",{parentName:"li"},"And new option ",(0,o.yg)("inlineCode",{parentName:"p"},"shade.identifier")," and ",(0,o.yg)("inlineCode",{parentName:"p"},"shade.options")," in env block of config file, ",(0,o.yg)("inlineCode",{parentName:"p"},"shade.identifier")," indicate what the encryption method that you want to use, while ",(0,o.yg)("inlineCode",{parentName:"p"},"shade.options")," specifies which parameters should be encrypted/decrypted. In this example, we should add ",(0,o.yg)("inlineCode",{parentName:"p"},"shade.identifier = base64")," in config as the following shown:"),(0,o.yg)("pre",{parentName:"li"},(0,o.yg)("code",{parentName:"pre",className:"language-hocon"},'#\n# Licensed to the Apache Software Foundation (ASF) under one or more\n# contributor license agreements.  See the NOTICE file distributed with\n# this work for additional information regarding copyright ownership.\n# The ASF licenses this file to You under the Apache License, Version 2.0\n# (the "License"); you may not use this file except in compliance with\n# the License.  You may obtain a copy of the License at\n#\n#     http://www.apache.org/licenses/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an "AS IS" BASIS,\n# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n# See the License for the specific language governing permissions and\n# limitations under the License.\n#\n\nenv {\n  parallelism = 1\n  shade.identifier = "base64"\n  shade.options = ["username", "password", "f1", "config1.f1",  "config2.list"]\n}\n\nsource {\n  MySQL-CDC {\n    plugin_output = "fake"\n    parallelism = 1\n    server-id = 5656\n    port = 56725\n    hostname = "127.0.0.1"\n    username = "seatunnel"\n    password = "seatunnel_password"\n    database-name = "inventory_vwyw0n"\n    table-name = "products"\n    base-url = "jdbc:mysql://localhost:56725"\n    f1 = "seatunnel"\n    # custom shade options\n    config1.f1 = "seatunnel"\n    config2.list = ["seatunnel", "seatunnel", "seatunnel"]\n  }\n}\n\ntransform {\n}\n\nsink {\n  # choose stdout output plugin to output data to console\n  Clickhouse {\n    host = "localhost:8123"\n    database = "default"\n    table = "fake_all"\n    username = "seatunnel"\n    password = "seatunnel_password"\n\n    # cdc options\n    primary_key = "id"\n    support_upsert = true\n  }\n}\n'))),(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("p",{parentName:"li"},"Using the shell based on different calculate engine to encrypt config file, in this example we use zeta:"),(0,o.yg)("pre",{parentName:"li"},(0,o.yg)("code",{parentName:"pre",className:"language-shell"},"${SEATUNNEL_HOME}/bin/seatunnel.sh --config config/v2.batch.template --encrypt\n")),(0,o.yg)("p",{parentName:"li"},"Then you can see the encrypted configuration file in the terminal:"),(0,o.yg)("pre",{parentName:"li"},(0,o.yg)("code",{parentName:"pre",className:"language-log"},'2023-02-20 17:50:58,319 INFO  org.apache.seatunnel.core.starter.command.ConfEncryptCommand - Encrypt config: \n{\n    "env" : {\n        "parallelism" : 1,\n        "shade.identifier" : "base64"\n    },\n    "source" : [\n        {\n            "base-url" : "jdbc:mysql://localhost:56725",\n            "hostname" : "127.0.0.1",\n            "password" : "c2VhdHVubmVsX3Bhc3N3b3Jk",\n            "port" : 56725,\n            "database-name" : "inventory_vwyw0n",\n            "parallelism" : 1,\n            "plugin_output" : "fake",\n            "table-name" : "products",\n            "plugin_name" : "MySQL-CDC",\n            "server-id" : 5656,\n            "username" : "c2VhdHVubmVs",\n            "f1" : "c2VhdHVubmVs",\n            "config1.f1" : "c2VhdHVubmVs",\n            "config2.list" : ["c2VhdHVubmVs","c2VhdHVubmVs","c2VhdHVubmVs"]\n        }\n    ],\n    "transform" : [],\n    "sink" : [\n        {\n            "database" : "default",\n            "password" : "c2VhdHVubmVsX3Bhc3N3b3Jk",\n            "support_upsert" : true,\n            "host" : "localhost:8123",\n            "plugin_name" : "Clickhouse",\n            "primary_key" : "id",\n            "table" : "fake_all",\n            "username" : "c2VhdHVubmVs"\n        }\n    ]\n}\n'))),(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("p",{parentName:"li"},"Of course, not only encrypted configuration files are supported, but if the user wants to see the decrypted configuration file, you can execute this command:"),(0,o.yg)("pre",{parentName:"li"},(0,o.yg)("code",{parentName:"pre",className:"language-shell"},"${SEATUNNEL_HOME}/bin/seatunnel.sh --config config/v2.batch.template --decrypt\n")))),(0,o.yg)("h2",{id:"how-to-implement-user-defined-encryption-and-decryption"},"How to implement user-defined encryption and decryption"),(0,o.yg)("p",null,"If you want to customize the encryption method and the configuration of the encryption, this section will help you to solve the problem."),(0,o.yg)("ol",null,(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("p",{parentName:"li"},"Create a java maven project")),(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("p",{parentName:"li"},"Add ",(0,o.yg)("inlineCode",{parentName:"p"},"seatunnel-api")," module with the provided scope in dependencies like the following shown:"),(0,o.yg)("pre",{parentName:"li"},(0,o.yg)("code",{parentName:"pre",className:"language-xml"},"<dependency>\n    <groupId>org.apache.seatunnel</groupId>\n    <artifactId>seatunnel-api</artifactId>\n    <version>${seatunnel.version}</version>\n    <scope>provided</scope>\n</dependency>\n"))),(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("p",{parentName:"li"},"Create a new class and implement interface ",(0,o.yg)("inlineCode",{parentName:"p"},"ConfigShade"),", this interface has the following methods:"),(0,o.yg)("pre",{parentName:"li"},(0,o.yg)("code",{parentName:"pre",className:"language-java"},"/**\n * The interface that provides the ability to encrypt and decrypt {@link\n * org.apache.seatunnel.shade.com.typesafe.config.Config}\n */\npublic interface ConfigShade {\n\n    /**\n     * The unique identifier of the current interface, used it to select the correct {@link\n     * ConfigShade}\n     */\n    String getIdentifier();\n\n    /**\n     * Encrypt the content\n     *\n     * @param content The content to encrypt\n     */\n    String encrypt(String content);\n\n    /**\n     * Decrypt the content\n     *\n     * @param content The content to decrypt\n     */\n    String decrypt(String content);\n\n    /** To expand the options that user want to encrypt */\n    default String[] sensitiveOptions() {\n        return new String[0];\n    }\n}\n"))),(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("p",{parentName:"li"},"Create a file named ",(0,o.yg)("inlineCode",{parentName:"p"},"org.apache.seatunnel.api.configuration.ConfigShade")," in ",(0,o.yg)("inlineCode",{parentName:"p"},"resources/META-INF/services"),", the file content should be the fully qualified class name of the class that you defined in step 3.")),(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("p",{parentName:"li"},"Package it to jar and add jar to ",(0,o.yg)("inlineCode",{parentName:"p"},"${SEATUNNEL_HOME}/lib"))),(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("p",{parentName:"li"},"Change the option ",(0,o.yg)("inlineCode",{parentName:"p"},"shade.identifier")," to the value that you defined in ",(0,o.yg)("inlineCode",{parentName:"p"},"ConfigShade#getIdentifier"),"of you config file, please enjoy it \\^_\\^"))),(0,o.yg)("h3",{id:"how-to-encrypt-and-decrypt-with-customized-params"},"How to encrypt and decrypt with customized params"),(0,o.yg)("p",null,"If you want to encrypt and decrypt with customized params, you can follow the steps below:"),(0,o.yg)("ol",null,(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("p",{parentName:"li"},"Add a configuration named ",(0,o.yg)("inlineCode",{parentName:"p"},"shade.properties")," in the env part of the configuration file, the value of this configuration is in the form of key-value pairs (the type of the key must be a string), as shown below:"),(0,o.yg)("pre",{parentName:"li"},(0,o.yg)("code",{parentName:"pre",className:"language-hocon"},' env {\n     shade.properties = {\n        suffix = "666"\n     }\n }\n\n'))),(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("p",{parentName:"li"},"Override the ",(0,o.yg)("inlineCode",{parentName:"p"},"ConfigShade")," interface's ",(0,o.yg)("inlineCode",{parentName:"p"},"open")," method, as shown below:"),(0,o.yg)("pre",{parentName:"li"},(0,o.yg)("code",{parentName:"pre",className:"language-java"},'    public static class ConfigShadeWithProps implements ConfigShade {\n\n     private String suffix;\n     private String identifier = "withProps";\n\n     @Override\n     public void open(Map<String, Object> props) {\n         this.suffix = String.valueOf(props.get("suffix"));\n     }\n}\n'))),(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("p",{parentName:"li"},"Use the parameters passed in the open method in the encryption and decryption methods, as shown below:"),(0,o.yg)("pre",{parentName:"li"},(0,o.yg)("code",{parentName:"pre",className:"language-java"},"    public String encrypt(String content) {\n        return content + suffix;\n    }\n\n    public String decrypt(String content) {\n        return content.substring(0, content.length() - suffix.length());\n    }\n")))))}u.isMDXComponent=!0}}]);